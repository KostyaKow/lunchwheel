<html>
<head>
   <script src='https://cdnjs.cloudflare.com/ajax/libs/svg.js/2.2.5/svg.min.js'></script>
   <!-- https://github.com/alexei/sprintf.js -->
   <script src='https://code.jquery.com/jquery-2.2.0.min.js'></script>
   <script src='https://cdnjs.cloudflare.com/ajax/libs/sprintf/1.0.3/sprintf.js'></script>
   <script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>

   <script src='index.js'></script>
</head>
<body ng-app='foodwheel' ng-controller='foodwheel' ng-keypress='keyPress($event)'>

   <table id='placesList' style='border:1px solid black' >
      <tr ng-repeat='(name, weight) in places'>
         <td>{{ name }}</td>
         <td>{{ weight }}</td>
         <td><button ng-click='remove(name)'>delete</button></td>
      </tr>
   </table>

   Enter new place:</br>
   <input ng-model='placeName' type='text' />
   <select ng-model='placeWeight' ng-options='number for number in numbers'></select>
   <button ng-click="add()">add</button>

   <center> 
      <button ng-click='spin()'>Spin the Wheel!</button>
   </center>

   <div id='wheel-div' style='margin:0; width:600px; height:600px' style='float:left'>
   </div>
   <svg width=50 height=50 style='float:right; position:absolute; left:520px; top:500px'>
      <line x1='0' y1='10' x2='50' y2='10'
            style='stroke:rgb(250, 0, 0); stroke-width:15'>
      </line>
   </svg>


   <script>
      var colors = ['purple', 'yellow', 'blue', 'pink', 'orange', 'green', 'brown'];
      var currColorIndex = 0;
      function getColor() {
         if (currColorIndex+1 >= colors.length)
            currColorIndex = 0;
         return colors[currColorIndex++];
      }

      function makePie(places) {
         //'id':'wheelSvg'});
         var wheelEl = makeEl('svg', {'width':'550px', 'height':'550px', 'float':'left'});
         var centerX = 300, centerY = 300;
         var totalWeight = 0;
         for (var name in places)
            totalWeight += places[name];
         
         var startAngle = 0;
         for (var name in places) { //places[name] is weight
            var nextSize = places[name]/totalWeight * 360;
            var endAngle = startAngle + nextSize;
            var color = getColor();
            makeArc(wheelEl, centerX, centerY, 200, startAngle, endAngle, color);

            var textRotAngle = (startAngle + endAngle) / 2 - 90;
            var transform = sprintf('rotate(%i %i,%i)', textRotAngle, centerX, centerY);
            name = '. . . . . . .' + name;
            var textEl = makeText(wheelEl, name, centerX, centerY, 'black', transform);
            startAngle = endAngle;
         }

         /*var line = makeLine(500, 300, 550, 300);
         append(wheelEl, line);*/
         var wheelDiv = getById('wheel-div');
         wheelDiv.innerHTML = null;
         append(wheelDiv, wheelEl);

      }

      //makePie(places);

      /*makeArc(wheelEl, 300, 300, 200, 30, 180, 'purple');
      makeArc(wheelEl, 300, 300, 200, 0, 20, 'yellow');
      var line = makeLine(250, 250, 253, 253);
      append(wheelEl, line);*/


     </script>
</body>
</html>
